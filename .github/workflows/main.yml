name: DoraCore
on:
  workflow_dispatch:

jobs:
   build:
    runs-on: ubuntu-latest

    steps:
    - name: setting configurasi
      uses: actions/checkout@v3

    - name: setup environment
      run: |
          sudo apt-get update --fix-missing
          sudo apt-get install git make bc bison \
          openssl curl zip kmod cpio flex libelf-dev \
          libssl-dev libtfm-dev wget device-tree-compiler \
          ca-certificates python3 python2 binutils \
          binutils-aarch64-linux-gnu binutils-arm-linux-gnueabi \
          libghc-libyaml-dev libyaml-dev glibc-source

    - name: compile OSS LN8000
      run: |
          bash scripts/DoraCore/build.sh "OSS-LN8000"
      shell: bash

    - name: compile OSS
      run: |
          bash scripts/DoraCore/build.sh "OSS"
      shell: bash

    - name: compile MIUI LN8000
      run: |
         bash scripts/DoraCore/build.sh "MIUI-LN8000"
      shell: bash

    - name: compile MIUI
      run: |
         bash scripts/DoraCore/build.sh "MIUI"
      shell: bash

    - name: Upload files
      uses: appleboy/sftp-action@master
      with:
        server: sftp://dopaemon@frs.sourceforge.net
        username: ${{ secrets.SFTP_USERNAME }}
        password: ${{ secrets.SFTP_PASSWORD }}
        source: ZIPOUT/*.zip
        target: /home/pfs/project/android-unofficial/Doraemon-Kernel/RedmiNote10Pro/

